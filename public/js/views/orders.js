// Generated by CoffeeScript 1.9.1
(function() {
  var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  define(['jquery', 'backbone', 'collections/orders', 'utils', 'views/container', 'text!templates/orders.ejs', 'data', 'table'], function($, B, ordersCollection, U, ContainerView, ordersTemp, Data) {
    var View, columns;
    columns = [
      {
        field: '_id',
        title: '订单号'
      }, {
        field: 'status',
        title: '订单状态'
      }, {
        field: 'serviceStatus',
        title: '服务状态'
      }, {
        field: 'money',
        title: '订单金额'
      }, {
        field: 'time',
        title: '服务时长'
      }, {
        field: 'mode_zh',
        title: '支付模式'
      }, {
        field: 'username',
        title: '用户'
      }, {
        field: 'uid',
        title: '设备编号'
      }, {
        field: 'placeName',
        title: '场地方'
      }, {
        field: 'agentName',
        title: '代理商'
      }, {
        field: 'created',
        title: '日期'
      }
    ];
    return View = (function(superClass) {
      extend(View, superClass);

      function View() {
        return View.__super__.constructor.apply(this, arguments);
      }

      View.prototype.initialize = function() {
        this._filter = {};
        Data.orderColl = this.collection = new ordersCollection();
        this.render();
        this.fetch();
        return this;
      };

      View.prototype.events = {
        'click .selector': 'onSelect'
      };

      View.prototype.render = function() {
        this.$el.html(ejs.render(ordersTemp));
        this.$table = this.$el.find('#ordersTable');
        this.$container = this.$el.find('#seletorContainer');
        this.$table.bootstrapTable({
          columns: columns,
          striped: true,
          pagination: true,
          pageSize: 50,
          search: true,
          onClickCell: function(field, val, obj) {}
        });
        return this;
      };

      View.prototype.renderOrders = function(orders) {
        orders || (orders = this.collection.toJSON());
        return this.$table.bootstrapTable('load', orders);
      };

      View.prototype.fetch = function() {
        var self;
        self = this;
        return this.collection.fetch({
          remove: false,
          success: function(coll, res, opts) {
            return self.renderOrders();
          },
          error: function() {
            return console.log(arguments);
          }
        });
      };

      View.prototype.onSelect = function(e) {
        var $target, f, id, val;
        $target = $(e.target);
        id = $target.data('id');
        val = $target.html();
        f = {};
        f[id] = val;
        return this.filter(f);
      };

      return View;

    })(B.View);
  });

}).call(this);
